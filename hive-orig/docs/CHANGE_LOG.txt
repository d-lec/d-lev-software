//////////////////
// TODO | FIXME //
//////////////////
- TODO?: UART disable to keep serial noise from blowing out Flash load?
- FIXME?: LED[0] FPGA pin #
//////////////////

= GLOBAL ISSUES =
- Make HAL +,++,-,--,* defaults UNSIGNED, fix code if necessary.
- Fix HAL to take 16 bit unsigned immediates.
- Fix sim large stepping breakage.

////////////////
// CHANGE LOG //
////////////////
2023-06-20 : 0x7bbb846b
- A bit more robust against upload knob changes.

2023-06-15 : 0xd0fafad2
- Rearranged PITCH UI knobs.

2023-05-11 : 0x73c6c3d7
- For better preset backward compatibility:
- mode: pp_p6 => pp_p4.
- vmod: pp_p4 => pp_p6.

2023-04-13 : 0x615e3f1d
- PP tone knob boosts / cuts both bass & treb the same (~loudness).

2023-04-12 : 0xbe65815f
- Preview for vmod<0 is scaled ^3 for less abrupt turn-on.
- Moved v_pre_ds tap point to post vol_vel_knee().
- Moved vol_cvol() to post env_ad().
- Moved v_vol_knee() -96dB volume limit to v_lin_ds tap point.

2023-04-09 : 0x
- Wait[0] now bypasses ACAL auto-mute (h/t Roger).
- Preview bass & treb => tone (<0 bass boost, >0 treb boost).
- mode: pp_p4 => pp_p6.
- vmod: pp_p7 => pp_p4.
- Removed pp_p7 knob & ds.
- Rearranged PREVIEW UI knobs.

2023-04-07 : 0x5f8b3c13
- xl_mod() restored, new xvl_mod() for hinge @ -96dB.  
- params_addrs() sys_f change: <0:pre; 0:all; >0:pro.
- preset_*() name change: pre_pro_*().
- New pp_p7_ds knob @ end of presets for PP vmod.
- Rearranged PREVIEW UI knobs.

2023-04-06 : EXPERIMENTAL
- xl_mod() now hinges at -96dB for PP vmod.  
- slim() now calls slim_ubi() (free up code space).
- hp2() now used in place of bp2() for vol_bpf().
- hp2, lp4(), notch() now address pass-thru.
- Swapped Mon:L=>R, PP:R=>L for PP modes 1, 5, 9 (so L is dominant audio out):
- mode[3:0]  : pitch correct
- mode[7:4]  : no pitch correct
- mode[11:8] : hard quantization
- mode%4  L  R  PPL  PPR  4th
  ======  =  =  ===  ===  ===
       0  y  y   -    -    y
       1  y  -   -    y    -
       2  y  y   y    y    -
       3  -  -   y    y    -

2023-02-27 : 0x3173ef75
- Resonator HPF damping: 1=>1.5

2023-01-27 : 0x27c263bf - RELEASED : 2023-01-31
- Previous load had bad PP pvmod bug.
- PP & 4th osc modes now largely independent code blocks.
- PP pmod gain-up of xmix point limited to 48dB.
- PP 4th osc modes limited to pmod gain cuts (no boost).

2023-01-25 : 0x1517b9a5
- PP mode knob now controls ducking rather than prev knob sign.
- PP mode change: [-12:11] => [0:11] (type 0x8b => 0x0b).
- PP prev change: [-63:63] => [0:63] 48db_dn (type 0xf2 => 0x31).
- mode[3:0]  : pitch correct
- mode[7:4]  : no pitch correct
- mode[11:8] : hard quantization
- mode[0, 4, 8] : 4th osc
- mode%4  L  R  PL  PR  duck
  ======  =  =  ==  ==  ====
       0  y  y   -   -     -
       1  -  y   y   -     y
       2  y  y   y   y     y
       3  -  -   y   y     y

2023-01-24 : 0x7423bc2f
- PP xover point moved up: -48dB => -36dB (per Rob S.).

2023-01-22 : 0xcfc39a0b
- Voss-McCartney pink noise generator.
- Type 0x76 change: 86db_rev_dn => 96db_rev, rev logic now gives damping=1 @ enc[0].
- Farted about with damping gain interaction again, no good results.
- Presets need massaging for noise level, noise EQ, all filters reso, env fall.

2023-01-20 : 0x90d7e1b0 (installed on Rob S. P3)
- Voss-McCartney pink noise generator testing (works, commented out).
- PP prev back to [-12:11] (type 0x0b => 0x8b).

2023-01-15 : 0x69a8a5e0
- Moved cvol logic to sub, now positioned after envelope gen.
- Knob rename: cntr => cmod.

2023-01-14 : 0xc5e00c12
- PP prev [0:63]48db_dn => [-63:63]48db_dn (type 0x31 => 0xf2).
- PP prev => mode name change, now [0:11] (type 0x8b => 0x0b).
- Swapped PP mode and vmod UI pages, vmod disconnected.
- Swapped pp_p7 (mode) and pp_p4 (vmod) functionality in preset knob listing.
- PP vmod now cvol (pp_p7 => e_p7) volume drop at note boundaries.

2023-01-13 : 0xf766d637
- Noise level now a max, not part of mod (type 0x74 => 0x31).
- PP level now a max, not part of mod (type 0x74 => 0x31).
- Type 0x74 removed.

2023-01-01 : 0x2d58f653 - RELEASED : 2023-01-01
- RESON:mode back to 2020-05-30:
-  2 : parallel stereo
-  1 : parallel mono
-  0 : parallel hpf
- -1 : series mono
- -2 : series stereo

2022-12-29 : 0x1de995
- Noise vmod is now a simple gain break above kloc.
- Also removed /2 scaling of noise.

2022-12-16 : 0x9e489501
- Removed negative presets & profiles.
- Preset load[-124:124] => load[0:249] (type 0xfe => 0x7e).
- Preset stor[0:124] => stor[0:249].
- Profile Load[-3:3] => Load[0:5] (type 0xa3 => 0x05).
- Profile Stor[0:3] => Stor[0:5] (type 0x03 => 0x05).
- Type 0x7e range change: [0:124] => [0:249].
- Type 0xfe removed.
- So system profile 0 is now @ slot 250 (was 128 / -6).

2022-12-14 : 0x7ee024d0
- Presets now [-124:124], profiles now [-3:3].
- Type 0x7e range change: [0:120] => [0:124].
- Type 0xfe range change: [-120:120] => [-124:124].
- New type 0x7d for ACAL Wait[0:99].
- Type 0x74 range extended to -192dB (was -96dB) to fix rare PP leakage.
- NOISE:pmod 2x strength.

2022-12-01 : 0x2002a0d4
- New type 0xf2: signed 48dB_dn for *_FORM:levl phase control.
- Type removal: [0x30:0x33] (48db).
- Type reorder: [0x34:0x37] => [0x30:0x33] (48db_dn).
- Type reorder: 0xf2 => 0xfc (midi cc).

2022-07-21 : 0xadd46826
- PITCH:vmod 2x strength.

2022-07-18 : 0x68e1649a
- PITCH:vloc[0:63](fs) => vmod[-31:31](fs_sq), w/ logic changes.
- PITCH:levl => corr (just renamed).

2022-07-03 : 0x7bc1bd55
- MIDI:oct now combined with D-LEV:bank rather than 0_OSC:oct.

2022-07-02 : 0x
- MIDI bend[0] pitch bend now tx 8192 (centered, h/t Vincent).

2022-06-30 : 0x980731f6
- svf(): removed 4th order internal xmix, moved xmix outside.
- svf(): tried signed xmix, gave weird intermediate shapes.

2022-06-29 : 0x1d32e379
- Drop knob now squared (no type change):
- Old=>new Drop conversion:
-  1=>6
-  2=>8
-  4=>11
-  8=>16
- 16=>22
- 24=>28
- 30=>31

2022-06-26 : 0x895c582d
- New type 0xfd for Cent[-99:99].

2022-06-22 : EXPERIMENTAL
- New 'acal' command (immediate, no Wait timer).
- Moved external knob store to between sys & usr.
- Preset space expanded: [-99:99]=>[-120:120].
- Profile space expanded: [0:3]=>[-7:7].
- Profile space new offset: 100=>128.
- Type 0x7e: [0:99]=>[0:120].
- Type 0xfe: [-99:99]=>[-120:120].
- As a result of type changes:
-   Wait[0:99]=>[0:120] (0 to 12 sec).
-   Auto[0:99]=>[0:120].
-   load[-99:99]=>[-120:120].
-   stor[0:99]=>[0:120].
-   Load[0:3]=>[-7:7] (type 0x03=>0xa7).
-   Stor[0:3]=>[0:7] (type 0x03=>0x07).
-   Cent[-99:99]=>[-120:120].
- ~3 pages of mem left.

2022-06-21 : 0x637129f
- UI cleanup seems done.
- Preset & profile load & stor working.

2022-06-20 : EXPERIMENTAL
2022-06-19 : EXPERIMENTAL
- UI cleanup continues

2022-06-18 : EXPERIMENTAL
- Some recoding of encoder update subs, now update covers ALL encoders.
- Can switch LCD screens remotely.
- Can change load & stor encoder values remotely. 
- Needs work to load presets, UI cleanup.

2022-06-17 : EXPERIMENTAL
- Reduced hcl_str_ds max length: 64=>32.
- Reduced hcl_tok_str max tokens: 8=>4.
- HCL read & write commands now all share temp addr & data store.
- Implemented "rk" and "wk" HCL commands to read/write knob values.
- Needs work to load presets.

2022-05-10 : 0x93152c8b
- Moved thd_2 init code post display PWM to fix LCD flickering @ preset load.

2022-05-06 : 0xb11cf0fd
- Knob name and direction change: slew => rate.

2022-05-04 : 0xd202d35
- Worked on Inharmonic Resonator lp_w scaling & damping.

2022-05-03 : 0x
- Inharmonic Resonator overhaul, new absorbtive all pass filter construct.
- Fixed RESON:xmix leakage.

2022-04-30 : 0xaf3f63c4
- Knob rename: Vol => Mon.
- Line knob is now independent of Mon knob.

2022-04-26 : 0x6a83a73d
- Moved Drop & Lift code to main lines.

2022-04-25 : 0xc6b8ad41
- Drop implementation now ~identical to Lift.

2022-04-17 : 0x67517a97
- New global octave bank switching knob D-LEV:bank[-3:3].
- 0_OSC:oct knob functionality restored to oscillators and pitch preview.
- Lift scaled to 1/2 strength.
- Deleted null4_str() and the null check in param_str_cpy() (no empty knob slots).

2022-04-15 : 0x1a52d2a0
- Fixed: *2 (oct++) in pkg_osc:inc_mul_add().

2022-04-14 : 0x3ed50afe
- Major overhaul of octave bank switching, now a pitch field input.
- Lift logic now pre Sens scaling, linear knob scaling, works even w/ Sens[0].
- Presets need massaging due to pmod octave differences.

2022-04-07 : 0x5ba55477
- Lift logic moved to pitch_lift().

2022-04-06 : 0x5eda09b0
- Lift knob scaling now 4th order poly.

2022-03-29 : 0x48f2024e
- Lift knob scaling now 2nd order poly, applied as fixed 5.5 (like knee).

2022-03-22 : 0x57655de8
- Lift code simplified a bit and limited for safety.

2022-03-17 : 0x36d9b874
- Lift scaled 1/8 (Rob Schwimmer consulting).

2022-03-16 : 0xf23fb9d7
- P_FIELD:Trak => Lift.
- Lift[0:31] adds 2nd order analog squirreliness to near-field.

2022-02-05 : 0x7b6a0484
- Removed boot version (use CORE_VER in vect reg).

2022-01-20 : 0x7b6a0484
- Boot code reorg to prevent hours long hang with bad code length.
- Added boot version to top of boot code mem area.

2022-01-01 : 0x7b6a0484
- Knob rename: Curv => Drop.

2021-12-29 : 0x9bd1e23
- *_FIELD:Sens[0:127](48db_dn) => Sens[-127:127](fs_sq) - can reverse both fields!
- Removed 1 lower limit on both fields cal subtraction result (no difference?).
- Trad[-15:15](fs_sq) => Curv[0:31](48db_dn).
- MIDI:velo[0:31](48db) => velo[0:31](48db_dn).
- vol_trad() => vol_curve() (sub rename).

2021-12-27 : 0x3f29d6c5
- vol_trad() 4th order poly expands vol response down non-linearly.

2021-12-26 : 0xe4381634
- Voice preset load & store controls now lower case (Jeff).

2021-12-24 : 0x19e7be5c
- BUG! RESON:mode[0] didn't bypass (added jump).

2021-12-18 : 0x84f7f31c
- Moved MIDI UI page earlier, swapped PITCH and VOLUME pages.

2021-12-17 : 0x809d9261
- Press D-LEV:Out encoder to do ACAL.
- Page select encoder[7] press now the same as the others.
- Removed gpio_act[3] voice preset store (NC to expansion port).

2021-12-16 : 0x4ee0fbb0
- Encoder PB press now: 0=>max; max=>min; else=>0 (Vincent).

2021-12-15 : 0x9c64718
- Removed weird enc_deb() - seems to help bum encoders a little?
- PB & GPIO stability debounce now en masse, not bi-modal, 50ms timer (2x prev).
- External mute LED now doesn't blink with ACAL or write pending.

2021-12-14 : 0xc8ba498f
- MIDI:cc[0:31] => [-127:31] where negative CC values xmit 7 bit data (Vincent).
- MIDI:cc[0] disables CC xmit (Vincent).
- midi_act() and midi_cc_tx() now use v_pre_ds as volume input (Vincent).
- External ACAL now also uses the Wait timer (was: instantaneous).

2021-12-03 : 0x52fe7d  -= NEW DEFAULT D-LEV KIT LOAD (in Lydia's unit) =-
- MIDI:bend[0] range +/-50 => +/-200 cents (good suggestion from Vincent).

2021-12-01 : 0xa9db1e : EXPERIMENTAL - Sent to Jeff & Vincent -
- ACAL auto mute / unmute.  Unmute @ -48dB only if muted pre-ACAL.
- MIDI coding complete?  

2021-11-30 : EXPERIMENTAL - Broken!
- Negative MIDI channels give 2ms dead time between data clumps.
- Now calling acal_timer() @ 4.8kHz rate (1/10 isr).

2021-11-29 : EXPERIMENTAL
- Volume side processing tidying up.
- External ACAL now calls acal() directly, rather than via the timer.
- Renamed: v_pre_ds => v_raw_ds; p_pre_ds => p_raw_ds

2021-11-28 : EXPERIMENTAL
- More tinkering with the type system, doubled the signed singles areas.

2021-11-27 : EXPERIMENTAL
- Added MIDI deadtime timer, 3ms seems to help some synths?
- Reworking volume side mod & tuner routing.

2021-11-26 : 0x9197077b
- Type system tweaks: 
- New signed full scale squared types: [0xa8:0xab].
- Removed 0xf0 type.
- Recoding: 0xf0=>0xaa; 0xf1=>0xf0; 0xf2=>0xf1
- Pcal & Vcal 4x gain-up; type change: 0xa7=>0xab (fs=>fs_sq).
- damp type 0x73 2x range: [0:31]=>[0:63].

2021-11-23 : 0x9e90f98c
- Post knob is now [0:3]: 0=V&P pre; 1=P post; 2=V post; 3=P&V post.
- Pcal & Vcal knobs now [-127:127](fs) (type 0x23 => 0xa7).

2021-11-21 : 0x3a087623
- damp knob is now multiplicative: controls fall, all reso (filters & resonator).
- Removed damp dloc[0] disable.

2021-11-20 : 0x75235598
- Yet another overhaul of the type system, seems to be working OK (spot check).
- This also freed up more RAM.

2021-11-17 : 0xf1dec08c
- Formant output mix is now /8, sum, *8, sat.

2021-10-31 : 0x240b1e68 -= DEFAULT D-LEV KIT LOAD =-
- Preview oscillator phase now zeroed @ preset load.
- New mem_init() to zero out mem - freed up lots o' bytes!

2021-10-21 : 0x5244a7ea
- Trak now just an enable for pitch tracking 8th order LPF.
- Trak[0]: Pitch axis BW fixed @ 120Hz.
- Trak[1]: Pitch axis BW tracks @ -1 oct, [12Hz:120Hz] limits.
- Volume axis BW change: 100Hz => 120Hz.

2021-10-18 : 0xeb55bebb
- Knob name change: Vrev => Trad.

2021-10-15 : 0x89a927cc
- Auto[1] now doesn't reload preset[0].
- Knob name change: V_on => Out.

2021-10-14 : 0xc35eee13 (sent to Satre)
- Knob name change: On => V_on.
- Knob name & range change: Leak[-1:1] => Auto[0:99].
- Auto[0] disable; Auto[x] cycle thru x presets [0:x-1].
- Pitch hysteresis range is [A0:A2].

2021-10-13 : 0x
- Only one leak rate, -1 cycles thru presets [0:7], 1 doesn't.
- Pitch hysteresis range is [A0:A4].

2021-10-12a : 0x
- Dicking around with preset switching via pitch.

2021-10-12 : 0x
- Reversed Vrev sense, so closer=louder is default.
- Dicking around with preset switching via volume.

2021-10-11 : 0x
- Minor edits to recover some RAM, lcd_pwm() now not fully on.

2021-09-30 : 0xd3faa6f4
- lcd_pwm() now off for LCD[0].

2021-09-27 : 0xa2ca1b05
- Knob rename & rework: Mute => On, active sense changed.

2021-09-19 : 0xfa93bc5b
- LCD PWM rate was 300Hz, is now 240Hz or 200Hz (kill flutter).
- Sped up volume Leak null adaptation rate 4x.

2021-09-08 : 0x53bca892
- Knob rename: Brit => LED.

2021-09-07 : 0xb71fce46
- leak() now looks at p_lin and v_lin, rather than p_pre and v_pre.
- Rearranged SYSTEM page knobs a bit.

2021-09-04 : 0x3db2077b
- New knob Trak[0:7] for pitch tracking filter octave shift.
- New knob Leak[0:7] for unattended very slow ACAL.
- Removed Null knob (10 bytes free).
- Axis dither knobs now don't swap with P<>V.

2021-08-31 : 0x3366958d
- Encoder initiated ACAL now pre-mutes if Vrev=0.
- Expanded the P<>V modes:
- 0 : normal
- 1 : pitch follows volume field
- 2 : volume follows pitch field
- 3 : pitch and volume fields swapped
- FIXME: dither swap needs work (@ pkg_ui.hal:sys_regs_upd()).

2021-08-27 : 0x851a3f95
- Tuner center LED now indicates mute & ACAL & store (opposite sense of mute LED).

2021-08-26 : 0x3101e5ca
- Re-imagining of axis filtering:
- notch() now has fixed damping of 1/4.
- hum_filt() now employs 2x lp4() and 4x notch(), has 1 bit more headroom.
- pitch_track() now internal exp2, -2 oct, limits @ 10Hz & 100Hz. 
- volume axis BW now 100Hz also (was 150Hz).

2021-08-19 : 0xe9543cc
- reversed encoder rotation default to match Bourns.
- pitch_track() now uses oct again, max BW for both axes 200Hz => 150Hz.

2021-08-18 : 0xdbfa2538
- pitch_track() now uses p_exp as input, doesn't use oct, lower limit is 5Hz.
- hum_filt() has 1 bit less headroom, 1 bit more resolution.

2021-06-05 : 0x24f6cd91
- Now TX 0x7B (all notes off) and 0x78 (all sounds off) @ MIDI mute.

2021-05-27 : 0x86d93d17 (Roger's reference load)
- No functional change from yesterday, some cleanup.
- Experimented with triangular bump, squared curve is much better.

2021-05-26 : 0x
- Noise vmod now bump/dip @ -24dB (n_p9_ds type 0x84 => 0x4a).

2021-05-25 : 0x5185762e
- Noise drop is now vmod and uses the same code as PP.

2021-05-15 : 0x66392928
- MIDI changes as suggested by Vincent Dhamelincourt (Mr_Dham @ TW):
- TX (new) CC data @ 4.8kHz regardless of note state.
- State machine reduced to 4 states.

2021-05-11 : 0xf9e1c5c7
- Removed boot_ver define.
- "SW!" displayed on LCD @ boot w/ FPGA default.
- "ER!" displayed on LCD @ reg[2] non-zero.

2021-05-10 : 0x307c17fc
- Thread errors put "!ER! on main UI D-LEV page.

2021-05-09 : 0xd7f1628e
- uint16_to_bcd4() now uses looping.

2021-05-08 : 0x6b0401b1 : V01 <= NOTE!
- Wait[0:30] => Wait[0:99] for [0:9.9] sec ACAL.
- lcd_init_timer() now fixed and ~186 ms.
- Mute LED now blinks @ 2Hz during ACAL
- Mute LED preset write pending blink now more complex.

2021-05-04 : 0xf8cfdf8b
- UI page name changes: *_AXIS => *_FIELD.

2021-05-02b : 0xa46cf19e
- Better encoder velocity sign handling (kill if opposite inc).

2021-05-02 : 0x14de1d33
- Moved MIDI code to thread 7 XSR.
- Pared MIDI state machine down to 5 states.
- MIDI and encoder processing now time slice @ XSR/10 each (4.8kHz).

2021-05-01 : 0x9bb2f117
- Added method to clear resonator sample mem, lp, and idx's.
- Resonator idx change "boing" caused by bad sample mem pointer?

2021-04-29 : 0xfaae1a21 : B01 <= NOTE!
- Boot subroutine now returns flag: 0=booted from EEPROM; else booted from FPGA.
- FPGA boot now indicated on UI LCD (`boot_ver in pkg_defs.hal).
- Even more SPI code edits to make EEPROM CSn generally inactive for safety.
- EEPROM write protection code now in place and working.

2021-04-28 : 0xa105f5c7
- Lots of SPI code edits to make EEPROM CSn generally inactive for safety.
- EEPROM write protection code in place but commented out for now (in pkg_params.hal).

2021-04-26 : 0x727a9cf
- MIDI chan=0 now inhibits all MIDI TX activity (including mute).

2021-04-25 : 0xb589fbc8
- MIDI UI page changes:
- Knob rename: tloc => vloc.
- Some knob shuffling.

2021-04-24 : 0xd26bc87a
- Mute 0=>1 now sends MIDI note off and all sound off.

2021-04-19 : 0x8148cbb6
- PP now mixed in w/osc @ osc filter input when prvw={0,4,8}.

2021-04-05 : 0x932bed43
- MIDI chan now [0:16] to conform with stupid non-zero index; 0=off.

2021-04-04 : 0x2c95519d
- Moved MIDI UI page (after VOLUME page).

2021-03-25 : 0xd5890afc
- MIDI ctrl => cc.
- Minor MIDI knob shuffling.

2021-03-24 : 0xffef58b
- MIDI velo=31 now gives constant vel=127 (max).
- MIDI velo[0:31] type change: a0 (48db_dn) => c0 (48db).
- MIDI bend type change: e1 [0:63](inv) => e2 [0:127](inv) (why not). 
- MIDI active hysteresis now 1/128 (1/2 tloc detent).
- NOTE: keep MIDI cable away from antennae & ribbon cables!

2021-03-23 : 0x36b0e1ff
- MIDI pitch bend is finally working correctly (key frac now unsigned).
- MIDI knob cloc is now working.
- MIDI bend=0 doesn't disable +/- 1/2 new note PB range.
- Debug tool "receivemidi" seems to have a bug with cc14 decoding:
  - some msbs & lsbs are not correctly combined (nice tool though!).

2021-03-22 : 0x
- MIDI pitch bend is broken and always has been. The issue is frac 
  s/b unsigned and used in note replay pitch bend distance calcs.
- MIDI knob cloc is work in progress (code commented out).
- MIDI vloc => tloc.

2021-03-21 : 0x
- MIDI bend=0 now disables pitch bend.
- More MIDI velocity scaling & hysteresis.
- All non-sys oct now type 0x37 [-7:7], removed 0x79 [-7:3] type.
- Knob label changes: 
- All *oct knobs back to plain old "oct".
- Main => Vol.
- Lcd => LCD.

2021-03-20 : 0x
- MIDI velocity now preserved for replay past bend boundary.
- Worked on MIDI velocity scaling.

2021-03-19 : 0x
- MIDI velo knob now functional.
- New MIDI mode knob (non-functional).
- Knob label changes: 
- Vol => Main.
- oct => ooct; oct => poct; oct => moct; Oct => Octd.
- vvel => velo (2x).
- Bklt => Lcd.
- Shuffled DISPLAY UI page knobs.

2021-03-18 : 0x
- MIDI bend[0:31] => [0:63].
- MIDI is 7 state state machine to better distribute real time.
- Fixed vol_vel (broken yesterday).
- menu_param_ptr_ds now uses 16 bit pointers => 350 bytes free.
- Removed redundant menu ptr table entries => 430 bytes free total.
- lbl_to_str() is now generalized to mem_to_str(), using for UI page titles.

2021-03-17 : 0x
- MIDI pitch bend over multiple notes works.
- Deconstructed vol_vel for use with MIDI.
- Moved MIDI & NOISE UI pages.

2021-03-16 : 0x
- MIDI bend knob now functioning.

2021-03-15 : 0x
- Env gen dloc=0 now defeats damp switching.
- Knob name change: Adly => Wait.
- MIDI chan, vloc, and oct knobs now functioning.

2021-03-14 : 0x
- Ripped out all PV_MOD UI page code, knobs currently do nothing.
- 264 bytes free!

2021-03-13 : 0x
========================
= NEW FPGA LOAD 0x1312 =
========================
- MIDI reg[31] is now FIFO rd_rdy for metering data bursts.
- Some MIDI experimenting going on.

2021-03-09 : 0x23732755
========================
= NEW FPGA LOAD 0x1311 =
========================
- FPGA now has a single SPDIF register, SW now does 4x writes to it.
- New MIDI TX register & pins.

2021-03-06b : 0x503a8c21
- enc_deb() now hibernates, not a stability type thing.
- vec_deb() now bimodal, gpio rise/fall stability times: 25ms/250ms.
- Encoder throttle period reduced: 3.3ms => 2.5ms.
- Encoder modulo roll removed.
- lin_decay() decay time now 1.5s (compromise).
- led_blink() now 25% duty cycle for wr_st mute LED inversion blink.

2021-03-06 : 0xe0a1d401 - ??? SW DONE ??? -
- wr_st_ds is now 0,1 (was: 0,-1).
- Removed wr_st_rd() (too simplistic).
- lcd_bklt() rearranged a bit, now returns 0,1.
- led_blink() is new in pkg_ui.hal, handles mute LED, master gpio reg write.

2021-03-05b : 0xee6fbca4
- lin_decay() now has 2x velocity decay time (1.0s => 2.0s) to enahance modulo roll.

2021-03-01 : 0x91199711
- Bklt PWM value squared rather than the knob value.
- Bklt PWM rate now 300Hz to align with 60Hz/50Hz hum filter notches.

2021-02-28 : 0xc0d40cfc
- param_enc_upd(): if (velocity == 0) do modulo roll (h/t Roger).
- lin_decay() now has 2x velocity decay time (0.5s => 1.0s).

2021-02-25b : 0x48fc8c34
- GPIO mute input now toggles, for use with momentary switches.

2021-02-25 : 0x45f2c200
- New system knob Adly[0:30] to set ACAL delay in 1/10 sec incs. (h/t Roger)
- tuner() now uses audio noise source for LED pwm (code & time savings).
- Bklt knob PWM now 93.7Hz.

2021-02-24 : 0xe59fbc1d
- Refactored subs in pkg_tuner.hal:
- Fixed noise differentiation?
- Now when Brit=0 no data is sent to the tuner.
- Knob name & range change: Lite[0:1] => Bklt[0:31](fs).
- Bklt knob does straight PWM @ 46.875Hz.
- HCL commands restored.

2021-02-23 : 0x
====================================================================
= !!! BOOT AREA SHRINK & MOVE : NEW FPGA LOAD 0x1310 MANDATORY !!! =
====================================================================
- Re-wrote / shrank most subs in pkg_spi.hal, now boot < 256 bytes.
- Removed spi_rw(), spi_rw32(), spi_wr_timer() (unused).
- Removed all boot code references from main code.
- Commented out boot code addresses in pkg_defs.hal.
- UART now emits 'E' @ successful boot from EEPROM (was: \nBL\n).
- Removed Prvw knob from SYSTEM UI page.
- prvw on PITCH page is now per-preset.
- New Lite knob on DISPLAY UI page for LCD backlite (non-functional).
- FPGA build params change give 4 bytes per thread for CLT & IRQ:
  - CLT_SPAN : 'h3 =>`h2
  - IRQ_BASE : 'h40 => `h20
  - IRQ_SPAN : 'h3 => `h2
- Moved system and user preset locations in mem.
=> Some HCL commands commented out temporarily to make room!

2021-02-22 : 0x8f6ddc55
- Pitch correction changes:
- Slew mod now linear => exp2.
- Cntr knob now modulates rate down at note edges, up at center.
- Stuck a copy of Prvw on PITCH page for easier access.
- PITCH page knobs moved.

2021-02-21 : 0xe6f4283f
- Pitch correction changes:
- pitch_velo() is now slew_mod(), positional rather than velocity sensing.
- Knob name change: pvel => cntr.
- (vloc<0) : defeat both slew and cntr above vloc.
- PITCH page knobs moved around.

2021-02-20 : 0xece2ac0d
- Pitch correction changes:
- Moved (~vel * slew) pre lp1_ubi(), smooths out vmod switching.
- Tried bringing back the 3dB transition but it didn't sufficiently smooth.
- lp1_ubi() cutoffs are now: 1Hz/10Hz rise/fall.
- Fixed typo/bug in lp1_ubi() (P1 *= s2 s/b P1 := s2).

2021-02-19 : 0xa89bf09e
- Pitch correction changes:
- vloc range change: [-31:31] => [-63:63] (to match other vloc's).
- vloc low end change: -96dB => -48dB.
- vmod is now a switch rather than a 3dB transition zone (inaudible).
- (vloc>0) : defeat both pvel and slew below vloc.
- (vloc<0) : defeat only slew above vloc.
- (vloc=0) : defeat vmod.

2021-02-18 : 0x1a4305e7
- Pitch correction changes:
- Pitch 2x sawtooth is now tri/2 and relocated to pitch_velo().
- pvel type change: 0xa0 => 0xc0 (48dB_dn => 48dB).
- Relocated lp1_ubi() to pitch_velo().
- lp1_ubi() rates now 10Hz rise / 0.25Hz fall.
- vmod now dominates over slew & pvel.

2021-02-17b : 0x??
- Experimenting with pitch correction modulation:
- The larger of slew and vmod are use for slew, pvel modulates this.
- Have bimodal lp1_ubi() with differential rates.
- Removed squaring from pvel detector, too twitchy.
- Note 2x sawtooth into pvel detector gives it something to chew on.
- PITCH knob rename: corr => levl.
- PITCH page some knobs moved.

2021-02-17a : 0xa1ef4cd8
- Prvw range change: [0:23] => [-12:11]
- Prvw decode change:
  Prvw  L     R
  ----  ----  ----
   3    L+PP  R+PP
   2    L     R+PP
   1    L+PP  R
   0    L     R
  -1    PP    PP
  -2    PP+L  PP
  -3    PP    PP+R
  -4    PP+L  PP+R (same as 3)
- [-4:3] PP with PC (pitch correction).
- [-8:-5] & [4:7] PP with no PC or PQ.
- [-12:-9] & [8:11] PP with PQ (pitch quantization).

2021-02-16 : 0x?
- Inverse types now 16.16 & much easier to think about.
- knee() now uses inverse type 0xe4, also range change: [0:63] => [0:31].
- vvel range change: [0:63] => [0:31].
- Prvw range change: [-7:7] => [0:23].
- Prvw decode change ([8:15] & [16:23] same switching as [0:7]):
  Prvw  L     R
  ----  ----  ----
   0    L     R
   1    L+PP  R
   2    L     R+PP
   3    L+PP  R+PP
   4    PP    PP
   5    L+PP  PP
   6    PP    R+PP
   7    L+PP  R+PP (same as 3)
- [0:7] PP with PC (pitch correction)
- [8:15] PP with no PC or PQ.
- [16:23] PP with PQ (pitch quantization).
   
2021-02-15 : 0x?
- New inverse types 0xe0 thru 0xe7.
- Span now completely linear via type change 0xa4 => 0xe4.
- Tried that with knee but it didn't seem as promising.

2021-02-14 : 0x?
- Test load for Roger, (Prvw < 0) give quantized PP (instead of no quant PP).

2021-02-13 : 30da68ea_6db & 28584bb7_3db
- Pitch correction modulation "vloc" knob now working.
- Breakage was due to boot code edit which shifted the SPI sub addresses.

2021-02-12 : 0x??  BROKEN!
- Added manual defines for boot code SPI subroutine addresses.
- Added pc_vmod() subroutine, not incorporated in PC yet.
- PC vmod => vloc, type change, currently not functional.

2021-02-11 : 0xcc73477f
- Two encoders really acting up, new enc_deb() enforces 3.3ms minimum stability.
- lin_decay() oscillation fixed.
- In FPGA hive_pkg.sv bumped up ENC_DEB_W: 14 => 16.
- 97.9% memory usage!

2021-02-10 : 0x5424b3f5
- Encoder velocity system revamped & fully functional.
- enc_accum() uses new lin_decay().
- input_cond() sample & debounce @ enc[0], 8 calls total (6kHz).

2021-02-09 : 0x??
- enc_accum() now services single encoder.
- input_cond() now does sampling & debounce, then enc_accum(), for 9 calls total (5.333kHz).

2021-02-08 : 0x??
- Pitch correction note_span() had bug, reverted substantially to previous working code.
- Adjusted span knob scaling in note_span() (1/2 gain).
- Major changes to pkg_enc.hal subs, now ship simple data one way from xsr_7 to 
  thd_7 domain, do modulo subtract for encoder deltas and all change flags there.
- Not yet implemented: encoder velocity.
- Removed mul_int_ufix() from pkg_int.hal (unproven).

2021-02-07 : 0x??
- Pitch correction vh_mod is now * -4 (-48dB range) ^4 (sharper knee).
- ui() now runs in main loop with hcl() => no more ISR errors in reg[2] - yay!
- hcl() now returns if no UART RX data (loop moved to thread 7 main).
- hcl_init() contains hcl() init code (run once @ thread start).
- acal_timer() sized to work at 48kHz ISR rate.
- Removed lcd_upd_timer() (unused).

2021-02-06 : 0x??
- Removed encoder velocity gain-up for now, was making encoders look broken!?!
- pitch_track() LP4 min=10Hz (was 20Hz, too noisy @ farfield).
- pitch_track() octave only neg offset (+ too noisy @ farfield).
- Envelope vol_velo() bp2() 16Hz => 10Hz.
- Pitch corrector pitch_velo() bp2() 16Hz => 10Hz.
- Removed 4x gain & sat in pitch corrector (lowering the BW produces more gain).

2021-02-05 : 0x874d9a69
- Envelope Generator Changes -
- Minimum volume now -96dB (0x8000_0000):
  - Don't waste envelope time below that.
  - Super low volumes can hard mute the DAC.
- Type changes: 
  - rise: 0xb1 => 0xd9 : 48dB_rev_dn to 72dB_rev (!dn: don't want infinite attack time).
  - fall & damp:  0xb1 => 0xb9 : 48dB_rev_dn to 84dB_rev_dn.
- Switching for rise, fall, damp removed.
- Slew rate for rise, fall, damp all now 1.3ms/98dB min.
- Renamed: pf_track() => pitch_track() in pkg_filt.hal.

2021-02-04 : 0x??
- lp1() now can't overload (+1 cycle).  
- New lp1_u() which is the same but unsigned I/O.
- Removed lp2() (unused & a bit weird).
- Pitch corrector back to using lp1_u() @2Hz instead of slew_ubi().
- Pitch correction "vloc" knob now modulates slew.

2021-02-03 : 0x??
- Envelope vol_velo() now uses new bp2() filter @16Hz.
- Pitch corrector pitch_velo() now uses new bp2() filter @16Hz.
- Pitch corrector now uses slew() instead of lp4().
- Pitch corrector now uses slew_ubi() instead of lp1().
- Lots of envelope and pitch corrector parameter scaling.
- Pitch correction "vloc" knob is do-nothing at the moment.
- Shaved 1 cycle off of all log2 subroutines via reverse subtract opcode.

2021-02-02 : 0x??
- Fixed ~2x error in pitch tracking LP4 cutoff scaling calc (C8 => A8 fs).
- Pitch axis tracking LP4 now min=20Hz (was 8Hz), max=200Hz (was 300Hz@60Hz / 250Hz@50Hz).
- Volume axis LP4 now fixed at 200Hz (was 300Hz@60Hz / 250Hz@50Hz).
- Moved pitch axis tracking LP4 calcs & limits to pf_track() in pkg_filt.hal.
- Hum filter notch freqs slightly more exact (calcs in tuner spreadsheet).

2021-02-01 : 0x??
- pc_p0 pvel[0:31] type change: 0xA0 => 0xA8 (48dB => 72db)
- Dicking around with the pitch corrector again.

2021-01-31 : 0xb17caa3d
- sgn_plat3c_exp() now has explicit extremes for -127 & +127 knob values,
  which is an attempt to fix oscillator +/- octave phase drift (h/t Roger).

2021-01-12 : 0x5eb8b4ec
- ACAL now has 1 second delay (h/t Roger).
- Formant flag update code self-contained in form_flg_upd().

2021-01-11 : 0xe09f70eb
- Removed GPIO LED blink w/ preset write (wasn't blinking anyway).

2021-01-10 : 0x7fd3cc6d
- VOLUME knob name changes: 
  vloc (knee) => kloc
  vloc (damp) => dloc

2020-12-28 : 0x4888c5be
- Rename & range change: PP[0:15] => Prvw[-7:7]
- Prvw[-7:7] decode:
  Prvw  L     R
  ----  ----  ----
   0    L     R
   1    L+PP  R
   2    L     R+PP
   3    L+PP  R+PP
   4    PP    PP
   5    L+PP  PP
   6    PP    R+PP
   7    L+PP  R+PP (same as 3)
- Neg range same, but bypasses PP pitch correction.

2020-12-27 : 0xfd73e4ba
- PP pitch correction bypass now switchable via PP:
- PP[0:7]=post (old), PP[8:15]=pre (new).

2020-12-26 : 0x9ea163ae
- PP pitch correction bypass operation.

2020-10-30 : 0xca350048 - EXPERIMENTAL
- Removed external acal, dither reg writes.

2020-10-13 : 0xe547702
- Fixed disconnected m_p3 vloc (was used for resonator experimental loads).

2020-10-12 : 0x912ef289
- Resonator reso LPF scaling is now 0.375 + x^2 - (0.375 * x^4)).
- Resonator FB type 0x72 is now 72dB range (was 84dB).
- Back to hp4() @ resonator input.

2020-10-09 : EXPERIMENTAL
- Resonator testing (lpf brought out to a co-opted knob).

2020-10-08 : 0xc0dcd3b9
- Resonator output post LPF (test).

2020-10-07 : 0x9debadc9
- Slight reworking of reso & freq combo for LP (same functionality).

2020-10-06 : 0x698ffb03
- Removed resonator internal LP xmix, now using reso & freq combo for LP.
- Suspected BUG (thread 6 push error in HW, not in sim).

2020-10-05 : 0x90e865a4
- Resonator lp_w := reso[-63:63]^2 << 20
  The squaring is new, and darkens things up a bit with lower reso values.

2020-10-04 : 0xfc08d100
- Moved DISPLAY page to penultimate UI screen (for easier key transpose).

2020-09-19 : 0x9c9d6d1
- Resonator lp_x := (~freq[0:127] << 25)^2 
  The squaring is new, and makes decay times more constant over freq.

2020-09-15 : 
- Added mechanism to externally trigger presets update:
  - Added define `@pre_upd_ds 0x38df (to nail addr down).
  - Now calling params_use_upd() from preset_load().

2020-09-12 : 0xfc9f0d93
- Fixed Line * Vol in thd_6.hal (was sgn/uns, s/b uns/uns).

2020-09-09 : 0xd958d0a8
- Removed gpio[2] xcal.
- Added define `@pre_sys := 0x38e0 for start of system presets (@s_p0_ds).

2020-08-20
- Added "Line" level knob to "LEVELS" page (replaced "Mute").

2020-08-12
- New custom type for osc octave knob: 0x79, [-7:3].
- Changed PP oct from type 0x23 [-4:3] to 0x33 [-3:3].
- Changed PP knob from type 0x03 [0:3] to 0x07 [0:7].
- New PP knob functionality:
  PP  L     R
  --  ----  ----
   0  L+PP  R+PP
   1  L     R+PP
   2  L+PP  R
   3  L     R
   4  L+PP  R+PP
   5  PP    R+PP
   6  L+PP  PP
   7  PP    PP

2020-08-11
- Dith knobs now swap based on P<>V knob.

2020-07-13
- Pitch preview knob rename and range change: PPst[0:1] => PP[0:2].
- (PP==0) ? R=PP   : L=L
- (PP==1) ? R=R+PP : L=L
- (PP==2) ? R=R+PP : L=L+PP

2020-07-11
- All formants now have pvmod (shared in pairs with reson).
- oct[-4:3] (type 0x23) => oct[-5:4] (type 0x24).

2020-06-13
- Moved sys & usr params around in idx space.
- Updated librarian SW & converted all preset files.

2020-06-12
- Menu PB now: doesn't zero, does acal.

2020-06-08
- Reson mode knob == 0 now doesn't bypass HPF.

2020-05-31
- Moved knobs on LEVELS UI page.

2020-05-30
- Resonator mode sense flip to make more intuitive (I expect 2 to give pseudo stereo):
-  2 : serial pseudo stereo
-  1 : serial (reverb)
-  0 : formant bypass (variable w/xmix)
- -1 : parallel (formant fill)
- -2 : parallel pseudo stereo

2020-05-28
- Changed noise puls type to 0xa0, increased mult to 16.

2020-05-27
- Trying out offset to noise pulse.
- Moved knobs on 0_OSC UI page.

2020-05-23
- New noise pulse.

2020-05-20 : EXPERIMENTAL
- New oscillator variation (no PM thru).
- Tweaked osc0 / osc1 & 2 xmix, fm.
- Still dicking around with noise PWM.

2020-05-17 : EXPERIMENTAL
- Dicking around with noise PWM.

2020-05-16
- More linearization of harm & odd knobs, code moved to osc_harm_odd().

2020-05-15
- ~Fixed odd knob harmonic droop @ center.
- Touched up fm knob harmonic droop @ center also.
- Noise puls knob now [-63:63], where neg values use NCO + PM.
- Moved osc noise pulse code over to thread 4.

2020-05-14
- Removed neg fm knob routing option (not all that useful).
- Doubled noise puls knob range: 48dB => 96dB.

2020-05-13
- Brand new oscillator.
- O_P7 => xmix.
- O_P16 => hmul.
- O_P17 => hmul.
- O_P18 => offs.
- Fixed missing noise (needed 1 as lfsr init).
- Better aligned noise PWM with osc odd knob.

2020-05-12
- Clear / damp oscs & filters @ preset load.
- Negative fm now breaks pm feedback loop.
- Vol knob v_p6: user => system param.
- Bass knob eq_p0: user => system param.
- Treb knob eq_p1: user => system param.
- Cent knob p_p5: 0x43 [-127:127] => 0x78 [-99:99] type.

2020-05-06
- osc_pm() takes 77 cycles.
- PM forms loop: pm0 <= pm1 <= pm2 <= pm0.
- Some odd knob compensation for reduced PM @ center (-1/8 @ ends).
- Doubled top sprd rate.

2020-05-05 : EXPERIMENTAL
- New oscillator takes 75 cycles.
- Using new osc for PP.
- Deleted all unused osc code.
- Fixed noise PWM: nco offset based on odd.

2020-05-04 : EXPERIMENTAL
- Still working on oscillators.
- pm_unit() needs sin^2 offset of -1/8 to not interact with harm knob!
- pm_lut() replaced with pm_poly() (no internal mult in pm_unit()!).
- Preview harm is now [-31:31] w/ (harm < 0) giving odd harmonics (why not?).
- Deleted pm_lut().

2020-05-03 : EXPERIMENTAL
- Working on oscillators.

2020-05-02b
- Replaced osc fm PVMOD knobs with bass & treb.

2020-05-02a
- Moved PVMOD control from odd to fm - too subtle?

2020-05-01
- New triple oscillator with FM.
- PM unit has all/odd compensation for smoother transition.
- PM lut coefficients cranked on to compensate.

2020-04-29 : EXPERIMENTAL
- New PM unit, triple oscillator - THD3 RUNS OUT OF REAL TIME!

2020-04-21b
- All PVMOD knobs are now [-63:63] plat_1sq type 0x4a.
- Tons of PVMOD scaling touch-up due to the above.
- New sub: hmul_mod().

2020-04-21a
- Removed plat_5sq type, now plat_1sq.
- Swapped plat 1sq & 3cu type encoding.

2020-04-20
- Osc hmul pvmod is now pmvh_mod(), uses new plateau types.
- Needs work.

2020-04-19c
- Removed osc drop, squared noise drop knob, now [0:31].
- Restored noise/2 in noise_lvl_mod() (to reduce clipping).
- fixme: librarian

2020-04-19a
- New types [0x90:0x9f] for linear volume control.
- N_P9 rename: tilt => drop.
- Seems to be a lot of overload going on?
- fixme: librarian

2020-04-18c
- tilt_mod() now tilts osc (tilt < 0) / noise (tilt !< 0) down.
- N_P9 rename: vmod => tilt.
- *_lvl_mod() input level now (~, ^2, ~) to give finer resolution.
- fixme: librarian

2020-04-17
- Noise VMOD now hinges at volume knee vloc.
- Fixed PVMOD gains in osc harm, osc xmix, osc hmul, noise pwm.
- (Osc & noise vmod filter freq gains were actually OK.)
- fixme: librarian

2020-04-16
- Yet another PVMOD overhaul, dual pivots for some volumes, all gains 1.
- fixme: osc & noise vmod filter freq gains seem crazy high?
- fixme: librarian

2020-04-15
- fixme: librarian
- fixme: noise dynamic range issue

2020-04-14c
- Swapped PV_FMOD & RESON UI screens.

2020-04-14b
- Types [0xa0:0xbf] are now 48, 60, 72, 84dB.
- New types [0xc0:0xdf] same as [0xa0:0xbf] but w/o flooring.
- Types 0x74 is now 84dB.
- PC: filt/subf now 48db_rev.
- PC: filt/subf knob = 0 now overrides lp4() fc ~1kHz (was hissing).

2020-04-14a
- PC: filt/subf knob = 0 now skips lp4() freq scaling.
- PC: (vlin < -48dB) now defeats pvel.
- Removed pkg_vol::rate_sel(), funcionality moved to pitch & vol thds.

2020-04-13
- UI pages rename: EZ-PITCH => PITCH; ENVELOPE => VOLUME.
- Pitch correction knobs change:
- rate[0:63](72db) => filt[0:31](60db_rev) (PC_P1)
- subr[0:63](72db) => subf[0:31](60db_rev) (PC_P4)
- New system type 0xf4 [0:31](60db_rev) for above.

2020-04-12
- Moved PC 16Hz lp2() to end as 2Hz lp1(), modulates corr - fantastic!
- Envelope vvel knob (E_P4) now [0:63](48db).

2020-04-11
- Fixed envelope fall / damp scaling.
- Fixed quantized PC glitching: velocity now modulates filter cutoff (finesse me?).
- Also: there was a sign error in abs_vel_sq() causing some PC glitching (reworked this function).
- PC pvel & span knobs (PC_P0, PC_P2) now [0:31](48db).
- Envelope knee knob (E_P1) now [0:63](48db).
- Envelope vvel knob (E_P4) now [0:31](48db).
- PV_FMOD pmul & vmul knobs (M_P0, M_P2) now [0:63](48db).
- Almost out of real time on threads 0 & 1!

2020-04-10
- Rearranged knobs on envelope UI screen (back to the way they were).

2020-04-09
- Pitch correction has audible dead zone, reworked note_span() to be continuous.

2020-04-07
- Back to 2020-04-05 base.
- New vloc[0:63] knob for envelope damp  w/ slight changes to rate_sel().
- Rearranged knobs on envelope UI screen.
- Separated code into thd_0.hal, thd_1.hal, etc.
- Updated librarian SW.

2020-04-06
- Trying EXP side "velocity" again, seems to be a dud.
- !FIXME!: librarian SW knobs.

2020-04-05
- Noise PWM pmod now hinges @ 3/4, pmod[-63:63] => [0:63].
- Modulation functions & intermediate data more generic (lo, mid, hi hinge points).
- !FIXME!: librarian SW knobs.

2020-04-04
- !FIXME! - noise PWM pmod isn't optimal.
- puls[0:127] => [0:63].
- pmod[-63:63] => [0:63].
- Implemented pre_flags to signal preset load.
- All NCO's now zeroed @ preset load (removed all other zeroing logic).
- Worked on PV_MOD of osc hmul, new pv_mod2().
- PP & noise now turned completely off when levl = 0 (due to audible leakage).
- Evelope gen now uses -48dB as damping point.
- New rate_sel() for both envelope fall sel and pitch correct rate sel.
- Preset write armed label: !WR! => ?WR?.

2020-04-03
- x_mod() => p_mod(), v_mod() w/ vmod now hinging about 0dB (was -24dB).
- osc_mod() => harm_mod() + osc_pm2().
- harm_mod(): harm[-31:31] => [0:31], vmod & pmod gain increased.
- xmix_mod(): xmix[-63:63] => [0:31], vmod & pmod gain increased.
- svf_xmix(): xmix[0:63] => [0:31].
- reson_xmix(): xmix[-63:63] => [-31:31].
- Moved knobs around on 0_OSC & 1_OSC UI pages.

2020-04-02
- Oscillator changes for fractional hmul [0:2) w/ rudimentary PV_MOD.

2020-04-01c
- Back to 2020-03-30 base.

2020-04-01b - KINDA SUCKS
- Tried different pv_fmod(), it's OK but not an improvement.

2020-04-01
- Back to 2020-03-30 base.

2020-03-31 - SUCKS!
- pv_mod() changes for limited high end dynamic range.
- Removed /2 at output of pkg_mod.hal:lvl_mod().

2020-03-30
- Back to 2020-03-21 base.
- With 2020-03-27 osc, nois, prev: [0:127] => [0:63].

2020-03-27 - SUCKS!
- x_mod() and pv_mod() changes for increased low end dynamic range.
- osc, nois, prev knobs: [0:127] => [0:63].

2020-03-21 - NOT WORTH IT?
- Oscillator & UI overhaul:
- single harm & pvmod control.
- osc level is now pvmod (like noise & pp).

2020-03-15
- Fixed UI page label mixup between "RESON" & "PV_FMOD".
- UI page rename: "CORRECT" => "EZ-PITCH".

2020-03-10 : 0x1adb3f1
- Pitch & volume axis Lin[-15:15] sense reversal removed.  It is now a mid field boost / cut.

2020-03-09 : 0xb2316ffe
- Pcal & Vcal now [0:255].

2020-03-07
- Moved knobs on DISPLAY, V_AXIS, and P_AXIS UI pages.

2020-03-06
- Moved PV_FMOD UI page.
- Moved *_en knobs on PV_FMOD UI page.

2020-02-20
- x_fmod() is more like the knee, w/ loc & mult (sq).
- Fixed gains & overflow in mod_sel().
- Encoder renaming: *_hi => *pos; *_lo => *mul.

2020-02-10
- usr Load is now type 0x78 [-99:99], Stor is now type 0xf8 [0:99].
- sys Load & Stor are now type 0x03 [0:3] (@ slots 100 thru 103).
- Load encoders are again press to zero.
- UI screen renaming.

2020-02-09
- Menu page encoder is now type 0xff with no special handling outside the type system.
- Load & Stor now outside of the usr/sys preset system (no point in storing/recalling their values).

2020-02-08
- Load press to return to 0 is now explicitly coded.

2020-02-07
- [-127:-120] and [120:127] are now system, must press Load to load them.
- Loading sys preset returns encoders to 0 & loads that preset.
- Load press to return to 0 removed to support this.
- Removed 0x78 and 0xf8 types (load & stor).

2020-02-06
- Two fixmes below were due to unreferenced label outside Load code scope.
- Stor & Load sys encoders now non-functional but remain in-place.

2020-02-05
- Added Stor & Load encoders to SYSTEM UI page.  Kinda works
- fixme: pressing Stor kills sys param write, but external pushbutton doesn't?
- fixme: user preset Load encoder not working.

2020-02-04
- Mute is now a system preset parameter.
- External mute is now master w/ visual display when active.
- New dead_placeholder(), called once to keep unused parameters from shuffling things.

2020-02-02
- Fixed potential bug in pkg_ui.hal ui(): ireturn!
- New Stor pushbutton now works, with "!WR!" on display when armed.
- Removed 0xFF type (C/wr) & code support.
- todo: test external mute, make it give visual display when active.

2020-01-31
- Stor encoder now doesn't zero on press.

2020-01-30
- Back to separate preset Load & Stor encoders.
- fixme: gpio[1] xcal pin 129 cut off, so also using gpio[2] pin 132 to do xcal (in pkg_ui.hal)
- broken: can only write to slot 0 due to pb zero on Stor encoder.

2020-01-29
- Fixed bug in PB debounce, now uses full-scale u16 (0xffff).
- GPIO inputs are now debounced too.
- Mute uses debounced, xcal uses debounced button down.
- Removed enc_rd_ds from enc_sample() (was unused).

2020-01-28
- PB debounce completely revamped.

2020-01-27
- Pitch preview is now mixed in, rather than switched in.
- Knob rename: Mntr => Line

2020-01-26
- Rearranged UI screens a bit, more logical layout (for d-lib editor).

2020-01-25
- Osc and noise filter:
  - 4th order xmix taps fixed to enable full bypass.
  - 4th order damping & attenuation offset +1/256.

2019-09-18
- Fixed thread 7 reset via register set system lock up system.
  Cause was main mem overwrite into boot code area (wasn't subtracting len & crc 8 bytes from length).

2019-08-18
- Mod code review w/ a bit of refactoring / clarificaiton, no functional changes.
- Need to go through presets and fix noise levels / mod.

2019-08-13
- Noise pulse changes:
  - "puls" knob now 48dB range, duty cycle based.
  - New "pmod" knob for pulse width (+32 gives fixed pulse width).

2019-07-31
- Resonator changes:
  - "reso" control now sets feedback lpf cutoff (linear).
  - "freq" control now crossfades feedback lpf (linear).

2019-07-30
- Resonator changes:
  - Feedback lpf now tracks delay cutoff.
  - "reso" control now crossfades feedback lpf.

2019-07-29
- Feedback attenuation in reson is now post lpf (likely better SNR).
- Reson xmix code now in reson_xmix().
- Changed exp2_vlq() in pkg_params.hal to exp2_lq() to improve frequency accuracy.

2019-07-28
- New EXP2 types:
  - Return 0 out for 0 in.
  - New enc_exp2() and enc_exp2_dn() subs replace explicit dB ones.
  - Now have 24dB, 48dB, 72dB, 96dB types w/ [0:31], [0:63], [0:127], [0:255] ranges (and rev).
  - All filter resonance knob types changed 0xbe => 0xbd [0:63](96dB_rev).
  - Type 0xf5 removed, all volume & level knob types changed 0xf5 => 0xa5 [0:63](48dB).
  - Type rearrangement: 0xa[0:3] => 0xa[4:7]; 0xb[0:3] => 0xb[4:7].
- New 0x72 type for resonator resonance [-63:63](96dB).
- Ripped out types [0x48:0x5f] and [0x88:0x9f] (unused!).
- Noise and pitch preview knobs to [0:128](fs) which gives ~0.75dB / detent.
- Tweaked noise "puls" offset.
- Levels UI page knob rearrangement.

2019-07-26
- New 0xf5 type for volume / level ([0:63] 48dB, offs) ~0.75dB per detent.
- All applicable volume & level knobs changed 0x88 => 0xf5 type.
- Oscillator "sprd" knob changed 0x85 => 0xf5 type.
- Removed types 0xf0 and 0xf1 (display types).
- Moved types 0xe0, 0xe1, 0xe2 => 0xf0, 0xf1, 0xf2.
- Some cleanup in pkg_params.hal.

2019-07-25
- All filter (except resonator) resonance types changed from 0x75 [0:63](ncub) => 0x93 [0:127](96db rev).
- Removed 0xa- types and code.  Removed unused plateau code.
- Removed 32dB types, added 60dB types.
- Exponential types now start at 48dB (48dB, 60dB, 72dB, 96dB).
- Moved all types [0x60:0x8f] => [0x80:0xaf] (to make room for more +/- types).
- Moved type 0xdb => 0x73.

2019-07-23
- Resonator "hpf" knob type change: 0xae => 0xe1 (same as formant freq).
- Resonator "mode" knob now:
  -2 : parallel stereo
  -1 : parallel mono
   0 : bypass (same as xmix=0).
   1 : series mono
   2 : series stereo
- hp4() is now 2x hp2(), w/ damp=1 for both stages (was overloading @ max f).
- A bit of muting code touch-up.

2019-07-22
- Upper frequency limit for filters & oscillators now A8 (7040 Hz).

2019-07-21
- Replaced noise gray filter with separate bass & treble filters.

2019-07-20
- Noise "puls" knob is now constant time w/ 72dB range.

2019-07-18
- Tweaked resonator type e2 to display rounder freq numbers.

2019-07-17
- Finally fixed HCL stack fault bug!
- Acal knob now has reduced sensitivity (delta > 1 rather than chg).
- New pkg_ui.hal that now contains much of the UI code.

2019-07-15
- Added bass control to pitch preview (had to remove "mute" to make room).
- Renamed system knob "Nohp" => "Mntr" and inverted sense.
- A bit of knob rearrangement on "LEVELS" and "PREVIEW" UI pages.

2019-07-14
- Added HW & SW support for secondary SPDIF (for headphones).
- Added "Nohp" to SYSTEM UI page which routes PP to line out when enabled.
- Repositioned master volume control to after PP (was before).

2019-07-12
- Added svf_xmix() to fully turn off bypass when xmix=63.
- Add "ver" command to HCL to read EEPROM SW load CRC.

2019-07-10
- All xmix knobs now [0:63](fs) or [-63:63](fs) (doubled resolution).
- Resonator tap and harm knobs now [-63:63](fs) (doubled resolution).

2019-07-09
- Pseudo-stereo implemented with the resonator.
- Swapped resonator and bass & treble code threads 5 <=> 6, signal xfer between threads greatly reduced.
- Separate Dith knobs for P & V axes.
- Resonator mode now selects Series/Parallel and mono/stereo: 0=Pm, 1=Sm, 2=Ps, 3=Ss.

2019-07-07
- Resonator delay range was limited to 1/2 allocated mem (doh!).
- New resonator delay scaling function, e2 type w/ Hz display.
- Input level is now cross-faded with f_mix, w/ +/- for phase select.
- Resonator output now taken at delay output, rather than input mix.
- Mode now just selects input to resonator: 0=on_mix, 1=f_mix.
- Renamed resonator controls: dly=>freq, levl=>xmix, mode=>inpt.

2019-06-22
- 2nd order velocity pre-filters in pitch correction and envelope gen are now 2x 1st order (safer & more headroom).
- Pitch correction subr and envelope gen damp are now both [0:63](exp2_72db).
- Assembly bug?  Adding 127 bytes anywhere gives dead load! (root cause: boot mem reserve mismatch)

2019-06-21
- Scaled ENV_GEN:damp ~, ^2, ~, and some adjustment to strength.
- Commented out SVF_PV() minimum cutoff freq of ~16Hz.

2019-06-20
- Added knob subr to pitch correction, subroutine pitch_sub_rate(), sets LP4 rate below -48dB.

2019-06-17
- Added knobs n_en, o_en, f_en (noise, osc, formant) enables to PV_FMOD UI page.
  If enabled call pv_fmod(), else pv_mod().
- Removed svf_mod() & form_mod(), now do separate mod at source.

2019-06-15
- NOISE, PP, OSC harm & xmix pvmod back to pivoting type (@ -24dB, ~262Hz).
- Osc harm & xmix knobs now [-31:31].

2019-06-14
- New pv_mod everywhere, playing with weighting & +/-.

2019-06-13
- New pv_mod applied to PP, noise, osc harm (but not to osc xmix).

2019-06-12
- New pv_fmod now functional, applied to mod filters only.
- Moved some UI pages around.

2019-06-11
- Added knobs & UI page for pv_mod, x_mod(), currently non-functional. 

2019-06-10
- Ripped out vocal fry stuff.
- Moved some knobs around, a bit of renaming.

2019-06-06
- Messing around with vocal fry.

2019-06-04
- Fixed noise o_nco_ds read (was o_osc0_ds).

2019-05-26
- Moved form_flg() thread 6 => 7, flag => mem (real-time recovery).
- Write LED blink rate 1/2 (any faster reveals 12Hz LCD upd rate).

2019-05-25
- Fixed formant 6 (freq was type 0xe1, s/b 0xe0).

2019-05-24
- Added crossfade knobs to svf_mod() (osc & noise filters).
- Swapped resonator modes 0 & 1 (now 1 gives notch).
- Reordered the osc & noise & formant threads, now guaranteed to be phase coherent.
- Rearranged formant UI knobs a bit.

2019-05-23
- Formants now in 4 banks of 2.  Per bank: 1x form_mod(), 1x form(), common reso knob.
- Removed formant enable knobs: if all levls = 0 then bypass.
- Formant mixing: 1/4 each, sum, *4, sat (per 2 banks).
- Formant threads now guaranteed to be phase coherent.
- Moved osc filter UI page to end of osc section.

2019-05-22
- Refactored & simplified all formant & reson switching & mixing, removed form_mix().
- Formant mixing done with sufficient global headroom (1/16 each, sum, *16).
- Reson mode is now: -1=series, 0=parallel, 1=parallel 180 degree phase.
- Formant control is now just enable / disable for the entire bank.

2019-05-21
- Doubled the write LED blink rate.
- Removed 0xd0 type.

2019-05-20
- Now only writes to preset slot 0 save the system parameters.
  This has the side effect of making slot 0 the power-up default.
- Write LED now blinks.

2019-05-19
- Preset range now [-127:127]: -128=system, [-127:-1]=factory ROM, [0:127]=user R/W.
- Preset read & write via UART & TTL macros working!

2019-05-17d
- Fixed bug in CLI!  Was stack 1 push error (radix := 256) in ch_to_tok(). (NOT FIXED! see 2019-07-17)
- Fixed UI screen name: "11-9_FORM" => "9-11_FORM".

2019-05-17c
- Pressing Load PB now goes to and loads preset 1.
- Refactored preset load / store logic.

2019-05-17b
- Single knob voice selector for preset load / store now works.
- Needs some work to implement slot 0 and negative slots.
- Slot 0 is still for system params.
- Last slot saved is power-up default.

2019-05-17a
- Consecutive SPI EEPROM writes were failing, 25LC1024 needs 6ms between page writes!
- Moved a few knobs on filter & reson UI pages.

2019-05-17
- Fixed power-up acal bug ("P<>V" init value s/b 0).
- Fixed preset write UART interaction (placeholder stack 0 push fault).

2019-05-15
- 2nd order bass & treble controls.
- Refactored grey noise filter.
- Removed WR_2 knob.
- Systems knob labels now Title case rather than CAPS.

2019-05-14
- Added grey noise filter & knob.
- Swapped order of bass & treble controls for overload reasons.
- Fixed PP bug (was reading use nsqn value to switch rather than enc).

2019-05-13 - bad!
- PP and noise level use values are now scaled fs_nsqn.

2019-05-12
- Added global bass & treble EQ controls to "LEVELS" UI page.
- Removed loudness control on pitch preview, replaced with a treble control.
- Rearranged knobs on "LEVELS" and "PREVIEW" UI pages a bit.

2019-05-10
- Added knob "P<>V" to swap axes for southpaws (do acal after change).
- Renamed knobs: "*NUL" => "*CAL".

2019-05-09
- pv_mod() now has 96dB range w/ equal +/- limits, vol scaled same as pitch.
- Fixed noise pulse knob.
- Added system parameter "WR_2": 0 := 1 step stor, 1 := 2 step stor.
- C/WR now displays blank rather than "----" quiescent.

2019-05-07
- Added UI page for noise experiments:
  - Sparse noise (surprisingly a bust).
  - Pulsed noise.
- Rearranged osc & noise pages a bit.

2019-05-06b
- Removed PCAL & VCAL knobs (just placeholders now).

2019-05-06a
- Rotation of C/WR CW|CCW initiates acal (was CW only).
- Changes to C/WR (type 0xff) code in pkg_params.hal & theremin.hal.

2019-05-06
- Blend of 2019-05-05c & 2019-05-04.
- Removed extraneous call to enc_delta_upd() in params_page_upd().
- Encoder vel enc_inc_max := 10.

2019-05-05c
- Two-step store process, uses led_0:
  - LED is on when armed.
  - first press of C/WR arms.
  - second press of C/WR stores and disarms.
  - any other action during arm disarms.
- Pressing STOR now sets it equal to LOAD, rather than 0.
- Encoder vel := x + (x^3 >> 3); where enc_inc_max := 8.
- STOR re-enabled.

2019-05-05b
- Re-integrated most new enc & param code from load 2019-05-01.
- Renamed AC-S => C/WR.
- STOR disabled.

2019-05-05a
- A partial re-creation of load 2019-05-01 (didn't back it up and hit insurmountable thread 7 bugs).
- STOR disabled?

2019-05-04 - ok!
- Based on 2019-05-04_bad.
- Fixed bug (missing sub return) in pkg_params.hal.
- Didn't fix velocity bug (sq instead of abs) in pkg_enc.hal.
- STOR disabled (didn't change this) in theremin.hal.

2019-05-01
- Osc 0 & 1 are now the main oscillators, with osc 2 secondary.
- Osc 0 & 1 share common harm, hmul, sprd (now: golden ratio - 1).
- Oscs now sync when sprd == 0 and offs == {-127, 0, 127} so harmonics align for adding.
- Removed third UI page & extra knobs.
- STOR disabled.

2019-04-28
- Added third oscillator & third UI page, & knobs.
- Osc filter moved to thread 4 (noise).

2019-04-27
- New signed 3 plateau exp2 type used for osc +/- 1 oct.
- Type system getting a bit unruly.

2019-04-26
- Rewrote / rearranged much osc code: single nco, oct external.

2019-04-21
- Renamed CALw => AC-S.
- Preset store pushbutton now AC-S only.
- Factoring of oscillator code, playing with more pvmod options.

2019-04-16
- Renamed acWR => CALw.
- Preset store pushbuttons now both STOR and calW (use either).

2019-04-15
- Phase mod feedback scaling now done via LUT.
- Preset store pushbutton is now acWR (acal button).
- System parameters are now in CAPS on LCD.

2019-04-14
- Inverted osc_0 output to give deep null beat.
- 1_OSC:offs is now [-127:127] (fs) w/ cubed plateaus.
- Phase mod feedback/poly scaling still needs work.

2019-04-13
- Reverted back to old preset code, refactored it a bit.
- New dual oscillator!
- Phase mod feedback/poly scaling needs a bit of work.

2019-04-12 - don't use, user preset stor broken!
- Working on new oscillator:
  - Phase mod feedback/poly scaling needs work.
  - "offs" knob not connected to anything.

2019-04-10 - don't use, user preset stor broken!
- Preset stor now backs up target slot to slot 127.
- Refactored preset load/stor code, now uses 128 byte buffer.
- Reverted back to 2019-04-04 pkg_vol.hal code:
  - env_gen() position lp2 & diff with gain pre log2 gives velocity "hump".
  - env_gen() knee gives velocity "sharp edge" sound.
  - env_gen() vvel knob is [0:63] (not +/-).
- env_gen() peak hold restored.
- Renamed v_lin_ds => v_pre_ds.
- Renamed v_env_ds => v_lin_ds.

2019-04-08 - don't use!
- Much envleope generator experimentation, post EXP2.

2019-04-07 - don't use!
- Much envleope generator experimentation.

2019-04-04
- Removed pvel.

2019-04-03
- Reverted back to 2019-03-31 code base.
- Env_gen() changes:
  - Volume velocity is now thresholded to give pulse, gain now pre log2.
  - vvel knob is now +/-, neg gives pulse w/ +/- threshold crossings.
- Copy of "cent" knob added to tuner UI page.

2019-04-01 - don't use!
- Much envleope generator experimentation, post EXP2.

2019-03-31
- Pitch correction: vvel parameter renamed pvel.

2019-03-26
- Envelope generator: added pvel parameter to envelope generator.
- Envelope generator: velo parameter renamed vvel.
- Pitch correction: rate parameter range now 72dB (was 48dB).
- Pitch correction: velo parameter renamed vvel.
- Some rearrangement of envelope generator code, subroutine naming.

2019-03-24
- Edited param_enc_upd() so pb press zeros out that encoder (except stor & load).

2019-03-18
- Support for latest FPGA load dither.

2019-03-02
- Brand new oscillator which mixes final waves rather than modulators.

2019-03-01
- Slightly tweaked one coefficient of sin2_int_lq() to prevent ufl/ofl, and ofl with squaring.

2019-02-24
- Reversed the sense of ENV_GEN:levl.
- Added ENV_GEN:damp knob to vary fall rate with position less than the knee levl.

2019-02-22
- Dither now user variable on UI system page.

2019-02-20
- Hum filter LP4 now pitch tracking -2 oct.
- Removed pitch & volume axis bandwidth controls on SYSTEM page, uses is penultimate notch as before.
- Moved 16Hz lp2 to pitch correction velocity sense.
- Some dinking around in the hum filter.
- New hp2() subroutine (d=2).
- f2_poly() slight tweaking of coefficients (see: 1st_2nd_filter_compensation_2019-02-20.xls).

2019-02-17
- Removed all saturation from hp1(), lp4(), hp4().

2019-02-16
- Hum filter LP4 now pitch tracking -1 oct to remove "traveling hump" in axis FFT.
- Encoder and LCD update now only @ encoder change to remove 12Hz hump in axis FFT.
  - As a result of this had to remove PC velocity display.
- Hum filter 120Hz notch damping is now 0.25 to stomp it more.
- Removed global loudness, PP loudness back to simple bass boost.
- Added second main UI page, currently a levels catch-all.

2019-02-02
- Pitch & volume axis bandwidth controls on MISC page for experimentation.
- Tuner quantization is now back to repeated squaring, [0:4].
- Headroom in hum_f() change.

2019-02-01
- Envelope generator velocity knob is back, needs work.

2019-01-29
- Osc odd parameter is back to [0:63].
- Moved odd pmod & vmod to SOURCE UI page.
- Renamed UI page: SOURCE => OSC.
- Removed secondary MISC page.

2019-01-26
- Encoder delta limit is now 8.
- Encoder acceleration function is now: delta + ((delta^4) >>> 8).

2019-01-22
- loud_comp() max is -36dB.
- loud_comp() has treble boost via dual shelving differentiation.

2019-01-19
- Master volume is now loudness, moved to MISC page.
- loud_comp() max is -40dB.
- loud_comp() has treble boost via differentiation.
- Added acal pin gpio[1].
- Put v_nul back on MAIN page.
- Added pow_f(), pow_f_lq(), and pow_f_vlq() to pkg_float.hal, now using pow_f_lq() for linearization.

2019-01-18
- v_mod is now scaled 1/2 p_mod (was 1/4).

2019-01-17
- New loudness subroutine (2x treble shelf cut).

2019-01-14
- Sim now displays CRC32 @ assembly (for load ID purposes).
- Sim TTL output file is now <crc>.ttl
- SVF damping now all cubed (was ^2^2).
- Moved some UI pages around.

2019-01-13
- Oscillator nco odd 180 degree phase offset for improved hmix blending.
- Trial pv_mod of odd param, knobs on MISC UI page.

2019-01-12
- Added mode = +/-4 notch to osc & noise filters.
- Removed most damping-based filter input scaling.
- Moved all filter attenuators from outputs to inputs.
- pv_mod() vol weighting is back to fixed 1/4 pitch.

2019-01-11b
- Removed t_p5_ds, moved c_p0_ds from pre to sys (last sys param).

2019-01-11
- PM oscillators revamped.
- All LFO hooks removed.
- PP octave is now an offset of the master oscillator octave.

2019-01-10
- Working on PM oscillators.
- Removed LFO & oscillator hooks.

2018-12-31
- Removed tuner "mode" knob & inv code, "brit"=0 now turns the display off.

2018-12-30
- First & second passes on oscillator "odd" blending.

2018-12-29
- Envelope generator rise & fall now individually ~maxed out with enc=0.
- PP now uses prev=0 as disable.
- PP vmod sensitivity now 4x, output vol now 1/2.
- Working on loudness compensation for PP.

2018-12-28
- Envelope generator rise & fall are back to [0:63](rev 48dB) with disable when both enc=0.

2018-12-27
- Encapsulated mains hum filter in hum_f() subroutine.
- Adjusted hum filter frequency table for 48.01432kHz sampling rate.

2018-12-26
- New Chamberlin notch mains hum filter: humf() x 6 with 0.125 damping.
- lp4() before that uses same cutoff freq as 5th notch.
- Removed cic_uint() from pitch & volume axis processing.
- Added pitch preview & UI page.
- LCD update timer is now 12Hz.
- Tuner PWM is now lfsr_32().

2018-12-22
- Hive core 13.05 w/ new 3rd order anti-alias filtering.
- Removed cc2_uint() from pitch & volume axis processing.
- Removed lpf0 (lp4) from pitch & volume axis processing.
- CIC hum filter now 8x decimation (was 16x).
- Envelope generator rise & fall now [0:127](rev 96dB) with ~1ms minimum 48dB delta.
- Added mute pin 128 (ground = mute).

2018-12-18
- Adding LFO hooks.
- Parameter name change: pre => post.

2018-12-16
- Parameter name change: knee => levl; xpnd => knee.

2018-12-13
- Added system parameter "erev" to optionally reverse encoder sense.

2018-12-12
- New pitch correction algorithm (dead zone / velocity / lp4).
- A bit of parameter renaming: step => qant; qant => span; hght => knee; knee => xpnd.

2018-12-06
- Changes to reflect new v13.04 core (reverse subtract; im AND, OR, XOR; opcode shuffle).

2018-12-04
- Worked on reson series / parallel switching, much more intuitive now.
- Jumbled params again to move reson() params before formants.

2018-12-03
- Pitch correction ~done, now has its own UI screen (params got all jumbled up in the process).
- Fixed preset load to prevent 0 (new type).
- New parameter type 0xF1 which displays use value as INT.

2018-11-30
- Increased volume knee low end resolution.

2018-11-27
- Still working on new pitch correction.

2018-11-25
- Working on new pitch correction.

2018-11-23
- Combined reson() c_fb and lpf: c_fb is now fs_ncubn, c_fb is abs fs.  I like this a lot.
- Made reson() tap sgn => uns, which makes sense as there is a null at the [0:63] 32 loc.

2018-11-21
- New parameter type 0xFF which displays use value as hex.
- uint_to_str() and int_to_str() now don't suppress leading zeros.
- Fixed signed squared & cubed params, weren't giving good max vals for reson().

2018-11-20
- Fixed level & knee bug.

2018-11-19b
- level & knee bug!
- Finally pulled envelope generator misc. code & subs together into env_gen().
- Velocity now scaled (via offset) by knee level.
- Recombined knee & velocity.  Works great!

2018-11-16
- Added encoder delta limit, velocity scaling is now ((1<<lim(accum))>>3)+lim(accum) where lim=7.
- enc_delta_max is now a parameter in pkg_defs.hal (lim above).
- Envelope generator level param now [0:63] and reversed sense, knee param also now [0:63].
- LED tuner brightness quantization parameter was [0:7], is now [0:3].
- Tinkering in pkg_filter.hal, added sat and removed headroom in lp4().
- Fixed reso parameter type bug.

2018-11-13
- Minor parameter type shuffle, refactor of param_use_upd().

2018-11-12
- Working on more parameter types & shuffling encode decode.
- Futzing around with reson parameter scaling again.
- Fixed pitch correction skip on (enc == 0) bug (wasn't bypassing due to exp2 scaling).

2018-11-11
- Finally combined knee & velocity!
- Eliminated note_frac() in pkg_tuner.hal.

2018-11-09
- More parameter encoding changes.  Added reverse exponentiated types.
- Changed envelope generator rise/fall to reverse exponentiated 48dB type.

2018-11-08
- A bit of a parameter encoding reshuffle to make decoding simpler.

2018-11-07
- Reson a_fb is now scaled 1/2 (too much internal feedback is always bad).
- Reson dly is now [0:127](fs_nsq).

2018-11-06
- Parameter type system overhaul done.
- Changed resonator hpf freq parameter to type 0x7a.

2018-11-05
- Parameter type system mostly overhauled.

2018-11-04
- Overhauling the parameter type system.
- Simplified HCL "crc" command to not take address parameter, edited the sim too.

2018-11-03
- Simplified velocity / envelope generation data path, removed damp knob.
- Rotary encoder now: enc^2.
- Some futzing around with UI.

2018-11-02
- Worked on reson():
  - Sample memory now 1024 deep.
  - Delay knob ("dly") sense reversed.
  - AP sample depth knob ("tap") selects fraction of total delay.
  - Comb delay = dly - tap.
  - Dedicated 4th order highpass filter at input.

2018-10-31
- LC_DPLL TEST LOAD!  10Hz hpf direct to L&R SPDIF.
- New package: pkg_noise.hal.
- Tuner PWM source is now lfsr_8() rather than a counter.
- LCD timer is now 48kHz / (255 * 16) = 11.7647Hz.

2018-10-30
- Fixed audio noise source as per spreadsheet: noise_2018-10-23.xls.
- Cranked up v_nul scale shl from 16 to 18.
- Removed pow_ufrac_*() functions from int package (unused).
- Increased lcd_ini_timer() from ~0.5s to ~1s (1st auto-cal settling time).
- Rotary encoder now: enc + (enc^3)/8.

2018-10-20
- Added lp4_rr() prior to CIC hum processing, pre and post LPF cutoff now 150Hz (post was 100Hz).
  This should provide -80dB anti-aliasing for 1/16 decimation CIC (48kHz/16=3kHz; Nyquist=1.5kHz; 1/10=150Hz).
- P&V axis processing now about as similar as I can possibly make them.
- Pitch correction parameter (BW) is now scaled EXP2 U3.3.
- Removed all FLOAT <=> INT/UINT conversion functions from pkg_float.hal.
- Removed all mixed FLOAT & INT/UINT functions from pkg_float.hal.

2018-10-19
- Added FLOAT <=> FRAC/UFRAC, may remove INT/UINT.
- Made P&V P1 (lin) parameters [-16:15], centered on 1/4, +/- 1/8.
- Made P&V P3 (sens) parameters scaled EXP2 U3.4.

2018-10-15
- Begin homolgation of P&V axis processing.
- Made P&V P2 (ofs-) parameters [0:127], more resolution.

2018-10-07
- Added inharmonic resonator, working on it.
- SVF damping max back to 1.
- SVF now has two internal saturation points to prevent limit cycles.

2018-10-02
- Lots of consolidation in pkg_filter.hal.
- All filter "damp" now "res" (1-d).

2018-09-22
- Added comb_ap() to pkg_filter.sv
- Most parameter use values = 1 (for thread utilization sim).

2018-09-20
- Back to Chamberlin SVF for all audio filtering.
- Damping parameter controls are now squared rather than exp2 for all filters.

2018-09-19
- New double damped SVF for all audio filtering.

2018-09-13
- Sped up noise sample generation.

2018-08-28
- Fixed "flat top" attack / decay by editing env gen code.
- Some parameters moved around on UI.

2018-08-25
- Formants now using form_mod().
- Osc now has post svf2_mod().
- Moved formants 3-5 to thread 6, enabled xsr_6.

2018-08-24
- Made svf2_mod(), using for noise filter.
- Modified svf_sel(), selection is simpler now.
- Moved noise & filter to thread 4.
- Moved formant filter bank to thread 5, enabled xsr_5.
- Made form_mod() but not using yet.
- Pitch correction parameter now cubed.

2018-08-21
- Minor changes to reflect new v13.02 core.
- Put oscillator octave knob on main UI page.

2018-08-20
- Tons 'o changes to reflect new v13.01 core.

2018-07-30
- Revamp / reorg of velocity envelope code.
- Envelope gen is now only in velocity leg.
- Added slim_fall() to position leg to facilitate retrigger.
- Cal is now a knob on preset page rather than a pnul pb.
- Back to separate system p_0 & v_0 offsets at auto-cal.
- Added master volume knob.
- Some renaming of parameter display names.
- Subroutine commenting changes everywhere.

2018-07-27
- Removed 1st order HP / LP from filtering options.
- svf_sel() improved with binary tree select.
- Removed a bunch of package filters not in use.

2018-07-22
- Made HARM param [-63:63] for a bit more flexibility.
- Removed HMIN param.
- Seriously monkeying with velocity code.

2018-07-19
- Made noise vol_drop() actually drop when set > 1.
- Monkeyed with vol_knee() also.
- Combined pnul & vnul to single pv_0.

2018-07-18
- Added system p & v offsets at auto-cal - nice!
- Added system 50Hz option (do auto-cal after change).

2018-07-14
- Pitch correction LP filter is now lp4_rr.
- Pitch correction parameter is now [0:63]^2 << 12.
- Pitch cents offset moved from tuner to pitch section (fixed).
- Fixed a parameter code bug (squared type [0xc8:0xcf]).

2018-07-13
- Pitch correction LP filter is now just a simple lp1_rr.

2018-07-06
- HMIN added to oscillator modulation code & menu page.

2018-07-04b
- Octave switch moved to oscillator modulation code & menu page.
- Modulation maxtrix work.

2018-07-04
- Filter frequency now 1/2 note spacing, ~16Hz to ~4kHz (e1 param type).
- Modulation maxtrix work:
  - Osc vmod is now [-31:31].

2018-07-03
- Some menu work.

2018-07-02
- Single phase accumulator oscillator with integer multiple offsets - awesome stuff!
- Removed all other old oscillator code.
- Some menu work.

2018-06-27
- Removed phase noise mod, also removed osc-based AM of noise (omod, vmod).
- Added and removed pitch mod of osc harmonics.
- Some menu work.

2018-06-21
- New self phase modulated oscillator (patent US4249447).
- Removed old oscillator code.
- Trying out phase noise modulation (not real useful).

2018-06-14
- Added LQ & VLQ versions of EXP2_F & LOG2_F (untested).
- Added LQ versions of SQRT_F & SIN_F (untested).
- Added HI versions of F_RD & F_WR.

2018-05-29
- Completely revamped the oscillator, reduces aliasing via harmonic limiting.
- Commented out baffle sim (out of real time on thread 3!).

2018-05-26
- Seriously messed with pitch & volume processing, volume side now more consistent wrt polarity.

2018-05-25
- FPGA logic now debounces encoders, which fixed the really flaky one.

2018-04-28
- Mains hum CIC now decimates by 16, which only needs 1/16th delay memory!

2018-04-27
- A bit of renaming here and there.
- Encoder reversing is HW issue (bad encoder).

2018-04-26
- Osc and noise generators are now 24 bit, filter "footroom" now filled with real data.
- New subs: noise() and noise_mod() (AM modulation).
- Order of noise and osc switched to facilitate AM noise mod.
- Back to LOG2 velocity scaling.
- Drop is now just over [0:1) range.
- Tweaked encoder velocity sq val - still seeing reversing !?!

2018-04-13
- Removed unused subs in pkg_filter.hal.

2018-04-01
- Added drop to noise envelope.

2018-03-31
- Playing with knee strength.

2018-03-29
- Rearranged and really simplified the envelope generation steps:
  knee => +velocity => peak => slew_lim

2018-03-28
- Removed pmod from osc (lame, no obvious use).
- Tried jitter again, still no real use.

2018-03-27
- Moved menus around some, playing with new oscillator stuff.

2018-03-26
- Tinkering with all volume package functions.  Velocity trigger now has variable threshold postion.
- Moved envelope knee to position between velocity trigger and attack/decay, shared threshold w/ vel.
- Volume envelope generation now has its own UI page.
- Expanded range of oscillator harmonics from [0:0.5] to [0:0.75].

2018-03-24
- New variable transition function env_break() for volume.

2018-03-23
- Testing hard transition + slew limiting for volume.

2018-03-20
- Made filter pitch and volume modulation strengths purely 2^n, made modulations signed to center them somewhat.

2018-03-19
- Ill-fated attempt @ jitter & shimmer: not really suited for Theremins?

2018-03-17
- Simplified volume and pitch axis modulation in filt() subroutine.  
- Modified e1 type to remove ENC 63 / USE 0.

2018-03-16
- Added volume and pitch axis modulation to filt() subroutine.  Pitch needs work.

2018-03-14
- New filter mode type f0: [-2:4].
- New volume type f1: [0:63]^2 << 20.  (tried dB & didn't like it)
- New damping type e2: EXP2(([0:63] + 2^7) << 25).  Zero value gives infinite sustain.
- Added 8 bits of "footroom" to filt_multi() which eliminated high-Q decay drop-off.

2018-03-13
- filt_multi() is new 1st & 2nd order general purpose filter.  Replaced all audio filters with it.
- svf() filter now has more efficient built-in pitch compensation, svf_quick() and sin_pi4() removed.
- Removed all unused subroutines from pkg_filt.hal.

2018-03-11
- delay() subroutine is now 16 bit signed.

2018-03-10
- Added inv_uint() subroutines to int package.
- Normalized baffle_sim() gain.

2018-03-09
- Added 100Hz 4th order LPF to pitch & volume processing (anti-alias).
- Added baffle_sim() to filter package.

2018-03-07
- Presets are now working.
- Fixed enc_chg() subroutine.

2018-03-06
- Scaled rotary encoder x^2 factor by 1/2 (too twitchy & noticed roll over/under).
- Added enc_chg() subroutine, now can check enc_chg_ds for encoder change / push button press events (self-clears @ LCD update).
- Redefined pitch and volume auto-cal to page 0 & enc pb 0.
